---
import Layout from "../layouts/layout.astro";
import VideoCard from "../components/VideoCard.astro";

const bands = [
  {
    name: "BUMP OF CHICKEN",
    description:
      "4人組ロックバンド。  【代表曲】天体観測 / 【有名曲】アカシア / 【好きな曲】望遠のマーチ",
    genre: "J-Rock",
    videos: {
      representative: "j7CDb610Bg0",
      famous: "4dnT-kKIO6Y",
      favorite: "Fk4sgvvHyeI",
    },
  },
  {
    name: "UNISON SQUARE GARDEN",
    description:
      "3人組ロックバンド。  【代表曲】シュガーソングとビターステップ / 【有名曲】オリオンをなぞる / 【好きな曲】春が来て僕ら",
    genre: "J-Rock",
    videos: {
      representative: "3exsRhw3xt8",
      famous: "Lw5o2pSrVbQ",
      favorite: "vrd95QQe6Gc",
    },
  },
  {
    name: "THE ORAL CIGARETTES",
    description:
      "4人組ロックバンド。  【代表曲】狂乱HeyKids!! / 【有名曲】起死回生STORY / 【好きな曲】愁",
    genre: "J-Rock",
    videos: {
      representative: "C-o8pTi6vd8",
      famous: "LqIbaicDP7A",
      favorite: "aBdrpVAr5-E",
    },
  },
  {
    name: "PompadollS",
    description:
      "5人組正統進化型・邦楽ロックバンド。  【代表曲】悪食 / 【有名曲】スポットライトジャンキー / 【好きな曲】日の東、月の西",
    genre: "正統進化型 J-Rock",
    videos: {
      representative: "nbYIDyGtOps",
      famous: "_jTYrUhm3vw",
      favorite: "v6Bd19sNiWc",
    },
  },
];
---

<Layout>
  <main class="max-w-4xl mx-auto px-4 py-20">
    {
      bands.map((band) => (
        /* articleに relative を追加（中の絶対配置要素の基準にするため） */
        <article class="band-card relative mb-32 p-4 border border-slate-700 rounded-lg bg-slate-800 opacity-0 translate-x-[-50px]">
          <div class="moving-text absolute top-0 left-[-50px] md:top-[-50px] md:left-[-100px] text-[5rem] md:text-[10rem] font-black leading-none whitespace-nowrap -z-10 opacity-10 text-transparent pointer-events-none [-webkit-text-stroke:2px_rgba(255,255,255,0.5)]">
            {band.name}
          </div>

          <span class="text-sm font-bold text-blue-400 block mb-2 relative z-10">
            {band.genre}
          </span>
          <h2 class="text-3xl font-bold mb-4 relative z-10">{band.name}</h2>
          <p class="text-slate-300 relative z-10">{band.description}</p>

          <div class="grid grid-cols-1 md:grid-cols-3 gap-6 mt-4 relative z-10">
            {/* 1. 代表曲 */}
            <VideoCard
              title="【代表曲】"
              textColor="text-blue-300"
              videoId={band.videos.representative}
            />

            {/* 2. 有名曲 */}
            <VideoCard
              title="【有名曲】"
              textColor="text-green-300"
              videoId={band.videos.famous}
            />

            {/* 3. 好きな曲 */}
            <VideoCard
              title="【好きな曲】"
              textColor="text-pink-300"
              videoId={band.videos.favorite}
            />
          </div>
          {/* 動画エリア終わり */}
        </article>
      ))
    }
  </main>

  <div
    id="cursor-glow"
    class="fixed top-0 left-0 w-64 h-64 bg-blue-500 rounded-full blur-[100px] opacity-60 pointer-events-none z-0 transform -translate-x-1/2 -translate-y-1/2 mix-blend-screen"
  >
  </div>
</Layout>

<script>
  import { gsap } from "gsap";
  import { ScrollTrigger } from "gsap/ScrollTrigger";

  gsap.registerPlugin(ScrollTrigger);

  // 1. オープニング
  gsap.fromTo(
    ".header-title",
    {
      scale: 10,
      opacity: 0,
      filter: "blur(20px)",
    },
    {
      scale: 1,
      opacity: 1,
      filter: "blur(0px)",
      duration: 2.5,
      ease: "power4.out",
      delay: 0.2,
    },
  );

  gsap.fromTo(
    ".header-subtitle",
    { y: 50, opacity: 0 },
    { y: 0, opacity: 1, duration: 1, delay: 1.5 },
  );

  // 2. スクロール連動
  const cards = document.querySelectorAll(".band-card");

  cards.forEach((card, index) => {
    // Tailwindのクラスに追加した .moving-text を取得
    const bgText = card.querySelector(".moving-text");

    const direction = index % 2 === 0 ? -200 : 200;

    // 背景文字がある場合のみアニメーション実行
    if (bgText) {
      gsap.to(bgText, {
        x: direction,
        scrollTrigger: {
          trigger: card,
          start: "top bottom",
          end: "bottom top",
          scrub: 1,
        },
      });
    }

    gsap.fromTo(
      card,
      { y: 100, opacity: 0 },
      {
        y: 0,
        opacity: 1,
        duration: 1,
        ease: "power2.out",
        scrollTrigger: {
          trigger: card,
          start: "top 80%",
          toggleActions: "play none none reverse",
        },
      },
    );
  });

  // 3. マウスストーカー
  const cursor = document.getElementById("cursor-glow");
  document.addEventListener("mousemove", (e) => {
    gsap.to(cursor, {
      x: e.clientX,
      y: e.clientY,
      duration: 0.3,
      ease: "power2.out",
    });
  });
</script>
